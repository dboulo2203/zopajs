<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D√©tails du Stage</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #8b4513;
            --primary-hover: #6d3710;
        }

        .text-primary-custom {
            color: var(--primary-color) !important;
        }

        .border-primary-custom {
            border-color: var(--primary-color) !important;
        }

        .btn-outline-primary-custom {
            color: var(--primary-color);
            border-color: var(--primary-color);
        }

        .btn-outline-primary-custom:hover {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            color: white;
        }
    </style>
</head>

<body class="bg-light">
    <!-- Header -->

    <div class="container pb-4">
        <!-- Loading Spinner -->
        <div class="card shadow-sm text-center py-5 d-none" id="loading">
            <div class="card-body">
                <div class="spinner-border text-primary-custom mb-3" role="status" style="width: 3rem; height: 3rem;">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <p class="text-muted">Chargement des d√©tails...</p>
            </div>
        </div>

        <!-- Error -->
        <div class="card shadow-sm text-center py-5 d-none" id="error">
            <div class="card-body">
                <svg width="60" height="60" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                    class="text-danger mb-3">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <h2 class="h4 mb-2">Erreur</h2>
                <p class="text-muted" id="errorMessage"></p>
            </div>
        </div>

        <!-- Detail Card -->
        <div class="card shadow-sm d-none" id="detailCard"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const API_BASE_URL = 'https://www.kusala.fr/dolibarr/api/index.php/products';
        const API_KEY = 'OpK1D8otonWg690PIoj570KdHSCqCc04';

        const loadingEl = document.getElementById('loading');
        const errorEl = document.getElementById('error');
        const errorMessageEl = document.getElementById('errorMessage');
        const detailCardEl = document.getElementById('detailCard');

        // Get stage ID from URL
        const urlParams = new URLSearchParams(window.location.search);
        const stageId = urlParams.get('id');

        if (!stageId) {
            showError('Aucun stage s√©lectionn√©');
        } else {
            loadStageDetails(stageId);
        }

        async function loadStageDetails(id) {
            loadingEl.classList.remove('d-none');

            try {
                const url = `${API_BASE_URL}/${id}?DOLAPIKEY=${API_KEY}`;
                const response = await fetch(url);

                if (!response.ok) {
                    throw new Error(`Erreur API: ${response.status}`);
                }

                const stage = await response.json();

                loadingEl.classList.add('d-none');
                displayStageDetails(stage);

            } catch (error) {
                loadingEl.classList.add('d-none');
                showError(`Impossible de charger les d√©tails du stage: ${error.message}`);
                console.error('Load error:', error);
            }
        }

        function displayStageDetails(stage) {
            const statusClass = stage.status === '1' ? 'bg-success' : 'bg-secondary';
            const statusText = stage.status === '1' ? 'Actif' : 'Inactif';

            detailCardEl.innerHTML = `
                <div class="card-header bg-white border-bottom">
                    <h2 class="h5 mb-3 text-primary-custom">
                        üë§ Stage
                    </h2>
                    <h3 class="h6 text-primary-custom mb-0 border-start border-primary-custom border-3 ps-2">
                        Identit√© du Stage
                    </h3>
                </div>

                <div class="card-body p-4">
                    <div class="mb-4">
                        <div class="row g-3">
                            <div class="col-md-3">
                                <label class=" fw-light">R√©f√©rence :</label>
                            </div>
                            <div class="col-md-9">
                                <p class="mb-0">${stage.ref || 'N/A'}</p>
                            </div>

                            <div class="col-md-3">
                                <label class=" fw-light">Nom :</label>
                            </div>
                            <div class="col-md-9">
                                <p class="mb-0">${stage.label || 'Sans titre'}</p>
                            </div>


                            <div class="col-md-3">
                                <label class=" fw-light">Date d√©but :</label>
                            </div>
                            <div class="col-md-9">
                                <p class="mb-0">${new Intl.DateTimeFormat("fr-FR",
                {
                    year: "numeric",
                    month: "numeric",
                    day: "numeric",
                    hour: "numeric",
                    minute: "numeric",
                }).format(stage.array_options.options_sta_datedebut * 1000)
                }</p>
                            </div>


                            <div class="col-md-3">
                                <label class=" fw-light">Dates fin :</label>
                            </div>
                            <div class="col-md-9">
                                <p class="mb-0">${new Intl.DateTimeFormat("fr-FR",
                    {
                        year: "numeric",
                        month: "numeric",
                        day: "numeric",
                        hour: "numeric",
                        minute: "numeric",
                    }).format(stage.array_options.options_sta_datefin * 1000)
                }</p>
                            </div>
                            
                            ${stage.description ? `
                            <div class="col-md-3">
                                <label class=" fw-light">Description :</label>
                            </div>
                            <div class="col-md-9">
                                <p class="mb-0">${stage.description}</p>
                            </div>
                            ` : ''}

                            <div class="col-md-3">
                                <label class=" fw-light">Code Comptable :</label>
                            </div>
                            <div class="col-md-9">
                                <span class="">${stage.accountancy_code_sell}</span>
                            </div>

                            ${stage ? `
                            <div class="col-md-3">
                                <label class=" fw-light">Publi√© en ligne :</label>
                            </div>
                            <div class="col-md-9">
                                <p class="mb-0">${stage.array_options && stage.array_options.options_sta_published === "1" ? "Oui" : "Non"}</p>
                            </div>
                            ` : ''}

                            ${stage ? `
                            <div class="col-md-3">
                                <label class=" fw-light">Participation compl√®te obligatoire :</label>
                            </div>
                            <div class="col-md-9">
                                <p class="mb-0">${stage.array_options && stage.array_options.options_sta_fullattend === "1" ? "Oui" : "Non"}</p>
                            </div>
                            ` : ''}

                            ${stage ? `
                            <div class="col-md-3">
                                <label class=" fw-light">Nb. max participants :</label>
                            </div>
                            <div class="col-md-9">
                                <p class="mb-0">${stage.array_options && stage.array_options.options_sta_nbmax}</p>
                            </div>
                            ` : ''}

                            ${stage ? `
                            <div class="col-md-3">
                                <label class=" fw-light">Lieu du stage:</label>
                            </div>
                            <div class="col-md-9">
                                <p class="mb-0"><strong>A finaliser
                                </strong></p>
                            </div>
                            ` : ''}

                            ${stage.tva_tx ? `
                            <div class="col-md-3">
                                <label class=" fw-light">TVA :</label>
                            </div>
                            <div class="col-md-9">
                                <p class="mb-0">${stage.tva_tx}%</p>
                            </div>
                            ` : ''}

                            ${stage.barcode ? `
                            <div class="col-md-3">
                                <label class=" fw-light">Code-barres :</label>
                            </div>
                            <div class="col-md-9">
                                <p class="mb-0"><code>${stage.barcode}</code></p>
                            </div>
                            ` : ''}

                            ${stage.stock_reel !== undefined ? `
                            <div class="col-md-3">
                                <label class=" fw-light">Stock r√©el :</label>
                            </div>
                            <div class="col-md-9">
                                <p class="mb-0">${stage.stock_reel}</p>
                            </div>
                            ` : ''}

                            ${stage.date_creation ? `
                            <div class="col-md-3">
                                <label class=" fw-light">Date de cr√©ation :</label>
                            </div>
                            <div class="col-md-9">
                                <p class="mb-0">${new Date(stage.date_creation * 1000).toLocaleDateString('fr-FR', { year: 'numeric', month: '2-digit', day: '2-digit' })} ${new Date(stage.date_creation * 1000).toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' })}</p>
                            </div>
                            ` : ''}

                            ${stage.date_modification ? `
                            <div class="col-md-3">
                                <label class=" fw-light">Derni√®re modification :</label>
                            </div>
                            <div class="col-md-9">
                                <p class="mb-0">${new Date(stage.date_modification * 1000).toLocaleDateString('fr-FR', { year: 'numeric', month: '2-digit', day: '2-digit' })} ${new Date(stage.date_modification * 1000).toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' })}</p>
                            </div>
                            ` : ''}
                        </div>
                    </div>

                    ${stage.note_public ? `
                    <div class="mb-4">
                        <h4 class="h6 text-primary-custom mb-3">Note publique</h4>
                        <div class="alert alert-light mb-0">
                            ${stage.note_public}
                        </div>
                    </div>
                    ` : ''}

                    ${stage.note_private ? `
                    <div>
                        <h4 class="h6 text-primary-custom mb-3">Note priv√©e</h4>
                        <div class="alert alert-light mb-0">
                            ${stage.note_private}
                        </div>
                    </div>
                    ` : ''}
                </div>
            `;

            detailCardEl.classList.remove('d-none');
        }


        // ${
        // intakeplaces.find((option) => option.rowid === stage.array_options.options_sta_place) !== undefined &&
        // (intakeplaces.find((option) => option.rowid === stage.array_options.options_sta_place).label)
        // }
        function getProductType(type) {
            const types = {
                '0': 'Produit',
                '1': 'Service',
                '2': 'Ensemble/Kit',
                '3': 'Mati√®re premi√®re'
            };
            return types[type] || `Type ${type}`;
        }

        function showError(message) {
            errorMessageEl.textContent = message;
            errorEl.classList.remove('d-none');
        }
    </script>
</body>

</html>